<html lang="en">
   <head>
      <!-- Required meta tags -->
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <!-- Bootstrap CSS -->
      <link rel="stylesheet" href="css/bootstrap.min.css">
      <link rel="stylesheet" href="css/page.css">
      <title>SatUI - Configuration</title>
      <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
      <script src="js/jquery-3.5.1.slim.min.js"></script>
      <script src="js/bootstrap.bundle.min.js"></script>
      <script>if (window.module) module = window.module;</script>
      <script src="js/satui.js"></script>
   </head>
   <body>
      <div id="container">
      <div class="accordion" id="configAccordion">
         <div class="card">
            <div class="card-header" id="headingProtocol">
               <h2 class="mb-0">
                  <button id="protocolbtn" class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#protocolCollapse" aria-expanded="true" aria-controls="protocolCollapse">
                  Satellite Protocol
                  </button>
               </h2>
            </div>
            <div>
               <div id="protocolCollapse" class="collapse show" aria-labelledby="headingProtocol" data-parent="#configAccordion">
                  <div class="card-body">
                     <div class="input-group mb-3">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Select Satellite Protocol</button>
                        <div class="dropdown-menu">
                           <a class="dropdown-item" onclick="selectProtocol('hrit')" href="#">HRIT (GOES 16/17)</a>
                           <a class="dropdown-item" onclick="selectProtocol('lrit')" href="#">LRIT (GOES 13/14/15)</a>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="card">
               <div class="card-header" id="headingSDR">
                  <h2 class="mb-0">
                     <button id="sdrbtn" class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#sdrCollapse" aria-expanded="false" aria-controls="sdrCollapse">
                     SDR
                     </button>
                  </h2>
               </div>
               <div id="sdrCollapse" class="collapse" aria-labelledby="headingSDR" data-parent="#configAccordion">
                  <div class="card-body">
                     <div class="input-group mb-3">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Select SDR Model</button>
                        <div class="dropdown-menu">
                           <a class="dropdown-item" onclick="selectSdr('cfile')" href="#">GNURadio Complex File</a>
                           <a class="dropdown-item" onclick="selectSdr('lime')" href="#">LimeSDR</a>
                           <a class="dropdown-item" onclick="selectSdr('rtlsdr')" href="#">RTLSDR</a>
                           <a class="dropdown-item" onclick="selectSdr('airspy')" href="#">Airspy</a>
                           <a class="dropdown-item" onclick="selectSdr('spyserver')" href="#">Spyserver</a>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="card">
               <div class="card-header" id="headingSDRSettings">
                  <h2 class="mb-0">
                     <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#sdrSettingsCollapse" aria-expanded="false" aria-controls="sdrSettingsCollapse">
                     SDR Settings
                     </button>
                  </h2>
               </div>
               <div id="sdrSettingsCollapse" class="collapse" aria-labelledby="headingSDRSettings" data-parent="#configAccordion">
                  <div class="card-body">
                     <h3>Global Settings</h3>
                     <div id="sdrGlobal">
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Frequency</span>
                           </div>
                           <input id="frequency" type="text" class="form-control" placeholder="1694100000" aria-label="Frequency" aria-describedby="basic-addon1">
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Decimation</button>
                              <div class="dropdown-menu">
                                 <a class="dropdown-item" onclick="$('#decimation').val(1)" href="#">1</a>
                                 <a class="dropdown-item" onclick="$('#decimation').val(2)" href="#">2</a>
                                 <a class="dropdown-item" onclick="$('#decimation').val(4)" href="#">4</a>
                                 <a class="dropdown-item" onclick="$('#decimation').val(8)" href="#">8</a>
                                 <a class="dropdown-item" onclick="$('#decimation').val(16)" href="#">16</a>
                              </div>
                           </div>
                           <input type="text" disabled id="decimation" class="form-control" placeholder="Decimation"/>
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <div class="input-group-text">
                                 <input type="checkbox" id="agcEnabled" aria-label="Sofware Automatic Gain Control">
                              </div>
                           </div>
                           <span class="form-control" aria-label="Bias T Enabled">Sofware Automatic Gain Control</span>
                        </div>
                     </div>
                     <hr/>
                     <h3>SDR Specific Settings</h3>
                     <div id="sdrConfigCFile" style="display: none">
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Filename</span>
                           </div>
                           <input id="filepath" type="text" class="form-control" placeholder="C:\test.cfile or /data/test.cfile" aria-label="Filename" aria-describedby="basic-addon1">
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <div class="input-group-text">
                                 <input type="checkbox" id="fastAsPossible" aria-label="Read input fast as possible">
                              </div>
                           </div>
                           <span class="form-control" aria-label="Read input fast as possible">Read input fast as possible</span>
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Sample Rate</span>
                           </div>
                           <input id="cfileSampleRate" type="text" class="form-control" placeholder="5000000" aria-label="Sample Rate" aria-describedby="basic-addon1">
                        </div>
                     </div>
                     <div id="sdrConfigAirspy" style="display: none">
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Mixer Gain</span>
                           </div>
                           <input id="airspyMixerGain" min="0" max="15" value="0" type="number" class="form-control" />
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">LNA Gain</span>
                           </div>
                           <input id="airspyLNAGain" min="0" max="15" value="0" type="number" class="form-control" />
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">VGA Gain</span>
                           </div>
                           <input id="airspyVGAGain" min="0" max="15" value="0" type="number" class="form-control" />
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <div class="input-group-text">
                                 <input type="checkbox" id="airspyBiasT" aria-label="Bias T Enabled">
                              </div>
                           </div>
                           <span class="form-control" aria-label="Bias T Enabled">Bias T Enabled</span>
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Sample Rate</button>
                              <div class="dropdown-menu">
                                 <a class="dropdown-item" onclick="$('#airspySampleRate').val(2500000)" href="#">2500000 (Airspy R2)</a>
                                 <a class="dropdown-item" onclick="$('#airspySampleRate').val(3000000)" href="#">3000000 (Airspy Mini)</a>
                                 <a class="dropdown-item" onclick="$('#airspySampleRate').val(6000000)" href="#">6000000 (Airspy Mini)</a>
                                 <a class="dropdown-item" onclick="$('#airspySampleRate').val(10000000)" href="#">10000000 (Airspy R2)</a>
                              </div>
                           </div>
                           <input type="text" disabled id="airspySampleRate" class="form-control" placeholder="Sample Rate"/>
                        </div>
                     </div>
                     <div id="sdrConfigRTLSDR" style="display: none">
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Mixer Gain</span>
                           </div>
                           <input id="rtlsdrMixerGain" min="0" max="15" value="0" type="number" class="form-control" />
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">LNA Gain</span>
                           </div>
                           <input id="rtlsdrLNAGain" min="0" max="15" value="0" type="number" class="form-control" />
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">VGA Gain</span>
                           </div>
                           <input id="rtlsdrVGAGain" min="0" max="15" value="0" type="number" class="form-control" />
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <div class="input-group-text">
                                 <input type="checkbox" id="rtlsdrBiasT" aria-label="Bias T Enabled">
                              </div>
                           </div>
                           <span class="form-control" aria-label="Bias T Enabled">Bias T Enabled</span>
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Sample Rate</button>
                              <div class="dropdown-menu">
                                 <a class="dropdown-item" onclick="$('#rtlsdrSampleRate').val(240000)" href="#">240000</a>
                                 <a class="dropdown-item" onclick="$('#rtlsdrSampleRate').val(300000)" href="#">300000</a>
                                 <a class="dropdown-item" onclick="$('#rtlsdrSampleRate').val(960000)" href="#">960000</a>
                                 <a class="dropdown-item" onclick="$('#rtlsdrSampleRate').val(1152000)" href="#">1152000</a>
                                 <a class="dropdown-item" onclick="$('#rtlsdrSampleRate').val(1200000)" href="#">1200000</a>
                                 <a class="dropdown-item" onclick="$('#rtlsdrSampleRate').val(1440000)" href="#">1440000</a>
                                 <a class="dropdown-item" onclick="$('#rtlsdrSampleRate').val(1600000)" href="#">1600000</a>
                                 <a class="dropdown-item" onclick="$('#rtlsdrSampleRate').val(1800000)" href="#">1800000</a>
                                 <a class="dropdown-item" onclick="$('#rtlsdrSampleRate').val(1920000)" href="#">1920000</a>
                                 <a class="dropdown-item" onclick="$('#rtlsdrSampleRate').val(2400000)" href="#">2400000</a>
                                 <a class="dropdown-item" onclick="$('#rtlsdrSampleRate').val(2560000)" href="#">2560000 (Recommended)</a>
                                 <a class="dropdown-item" onclick="$('#rtlsdrSampleRate').val(2880000)" href="#">2880000</a>
                                 <a class="dropdown-item" onclick="$('#rtlsdrSampleRate').val(3200000)" href="#">3200000</a>
                              </div>
                           </div>
                           <input type="text" disabled id="rtlsdrSampleRate" class="form-control" placeholder="Sample Rate"/>
                        </div>
                     </div>
                     <div id="sdrConfigLime" style="display: none">
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Gain</span>
                           </div>
                           <input id="limeGain" min="0" max="15" value="0" type="number" class="form-control" />
                        </div>
                        <div class="input-group mb-3">
                           <button id="limeAntenna" class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Select Antenna</button>
                           <div class="dropdown-menu">
                              <a class="dropdown-item" onclick="selectLimeAntenna('LNAL')" href="#">LNAL</a>
                              <a class="dropdown-item" onclick="selectLimeAntenna('LNAW')" href="#">LNAW</a>
                              <a class="dropdown-item" onclick="selectLimeAntenna('LNAH')" href="#">LNAH</a>
                           </div>
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Sample Rate</span>
                           </div>
                           <input id="limeSampleRate" type="text" class="form-control" placeholder="5000000" aria-label="Sample Rate" aria-describedby="basic-addon1">
                        </div>
                     </div>
                     <div id="sdrConfigSpyserver" style="display: none">
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Gain</span>
                           </div>
                           <input id="spyserverGain" min="0" max="15" value="0" type="number" class="form-control" />
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Hostname</span>
                           </div>
                           <input id="spyserverHostname" type="text" class="form-control" placeholder="0.0.0.0" aria-label="Filename" aria-describedby="basic-addon1">
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Port</span>
                           </div>
                           <input id="spyserverPort" min="0" max="65535" value="5555" type="number" class="form-control" />
                        </div>
                        <div class="input-group mb-3">
                           <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Sample Rate</span>
                           </div>
                           <input id="spyserverSampleRate" type="text" class="form-control" placeholder="5000000" aria-label="Sample Rate" aria-describedby="basic-addon1">
                        </div>
                     </div>
                     <button id="sdrConfirmBtn" onclick="setSDRSettings()" type="button" disabled class="btn btn-success">Select a SDR first</button>
                  </div>
               </div>
            </div>
            <div class="card">
               <div class="card-header" id="headingDemuxer">
                  <h2 class="mb-0">
                     <button id="sdrbtn" class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#demuxerCollapse" aria-expanded="false" aria-controls="demuxerCollapse">
                     Demuxer Settings
                     </button>
                  </h2>
               </div>
               <div id="demuxerCollapse" class="collapse" aria-labelledby="headingDemuxer" data-parent="#configAccordion">
                  <div class="card-body">
                    <div class="input-group mb-3">
                       <div class="input-group-prepend">
                          <span class="input-group-text" id="basic-addon1">Output Folder</span>
                       </div>
                       <input id="outputFolder" type="text" class="form-control" placeholder="out" aria-label="Filename" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group mb-3">
                       <div class="input-group-prepend">
                          <span class="input-group-text" id="basic-addon1">Temporary Folder</span>
                       </div>
                       <input id="temporaryFolder" type="text" class="form-control" placeholder="tmp" aria-label="Filename" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group mb-3">
                       <div class="input-group-prepend">
                          <div class="input-group-text">
                             <input type="checkbox" id="purgeFilesAfterProcess" aria-label="Purge Files LRIT Files after processing">
                          </div>
                       </div>
                       <span class="form-control" aria-label="Purge Files LRIT Files after processing">Purge Files LRIT Files after processing</span>
                    </div>
                    <div class="input-group mb-3">
                       <div class="input-group-prepend">
                          <div class="input-group-text">
                             <input type="checkbox" id="reprojectImages" aria-label="Reproject Images to Linear">
                          </div>
                       </div>
                       <span class="form-control" aria-label="Reproject Images to Linear">Reproject Images to Linear</span>
                    </div>
                    <div class="input-group mb-3">
                       <div class="input-group-prepend">
                          <div class="input-group-text">
                             <input type="checkbox" id="drawMap" aria-label="Draw Map Overlay">
                          </div>
                       </div>
                       <span class="form-control" aria-label="Draw Map Overlay">Draw Map Overlay</span>
                    </div>
                    <div class="input-group mb-3">
                       <div class="input-group-prepend">
                          <div class="input-group-text">
                             <input type="checkbox" id="falseColor" aria-label="Generate False Color Images">
                          </div>
                       </div>
                       <span class="form-control" aria-label="Generate False Color Images">Generate False Color Images</span>
                    </div>
                    <div class="input-group mb-3">
                       <div class="input-group-prepend">
                          <div class="input-group-text">
                             <input type="checkbox" id="enhanced" aria-label="Generate Enhanced Infrared Images">
                          </div>
                       </div>
                       <span class="form-control" aria-label="Generate Enhanced Infrared Images">Generate Enhanced Infrared Images</span>
                    </div>
                    <div class="input-group mb-3">
                       <div class="input-group-prepend">
                          <div class="input-group-text">
                             <input type="checkbox" id="metaFrame" aria-label="Generate Metadata Frame border on Images">
                          </div>
                       </div>
                       <span class="form-control" aria-label="Generate Metadata Frame border on Images">Generate Metadata Frame border on Images</span>
                    </div>
                     <button id="sdrConfirmBtn" onclick="setDemuxerSettings()" type="button" class="btn btn-success">Save Demuxer Settings</button>
                  </div>
               </div>
            </div>
            <div class="card">
               <div class="card-header" id="headingConfirm">
                  <h2 class="mb-0">
                     <button id="sdrbtn" class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#confirmCollapse" aria-expanded="false" aria-controls="confirmCollapse">
                     Save Settings
                     </button>
                  </h2>
               </div>
               <div id="confirmCollapse" class="collapse" aria-labelledby="headingConfirm" data-parent="#configAccordion">
                  <div class="card-body">
                    Do you wanna save the settings?
                     <button onclick="save()" type="button" class="btn btn-success">Save Settings and Continue</button>
                     <button onclick="exit()" type="button" class="btn btn-danger">Exit</button>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <script>
         let config = {};

         $("#configAccordion").hide();

         async function save() {
            await SatHelperApp_SetConfig(config);
            await SatHelperApp_SaveConfig();
            window.location.replace("main.html");
         }

         async function exit() {
            SatHelperApp_Exit();
         }

         function setDemuxerSettings() {
            config.DirectDemuxer.TemporaryFolder = $("#temporaryFolder").val();
            if (config.DirectDemuxer.TemporaryFolder === '') {
                config.DirectDemuxer.TemporaryFolder = 'tmp';
            }

            config.DirectDemuxer.OutputFolder = $("#outputFolder").val();
            if (config.DirectDemuxer.OutputFolder === '') {
                config.DirectDemuxer.OutputFolder = 'out';
            }

            config.DirectDemuxer.PurgeFilesAfterProcess = $("#purgeFilesAfterProcess").is(':checked');
            config.DirectDemuxer.ReprojectImages = $("#reprojectImages").is(':checked');
            config.DirectDemuxer.DrawMap = $("#drawMap").is(':checked');
            config.DirectDemuxer.FalseColor = $("#falseColor").is(':checked');
            config.DirectDemuxer.Enhanced = $("#enhanced").is(':checked');
            config.DirectDemuxer.MetaFrame = $("#metaFrame").is(':checked');
            $("#confirmCollapse").collapse('show');
         }

         function setSDRSettings() {
             // Base
             config.Base.SymbolRate = config.Base.Mode === 'hrit' ? 927000 : 293883;
             config.Base.RRCAlpha   = config.Base.Mode === 'hrit' ? 0.3 : 0.5;
             config.Base.Decimation = parseInt($("#decimation").val(), 10);
             config.Base.AGCEnabled = $("#agcEnabled").is(':checked');
             config.Base.SendConstellation = true;
             config.Base.DemuxerType = 'direct';
             config.Base.StatisticsPort = 5002;

             // Base Source
             config.Source.Frequency = parseInt($("#frequency").val(), 10);
             switch (config.Base.DeviceType) {
                 case 'limedrv':
                 case 'lime':
                     config.Source.SampleRate = parseInt($("#limeSampleRate").val(), 10);
                     break
                 case 'cfile':
                     config.Source.SampleRate = parseInt($("#cfileSampleRate").val(), 10);
                     break
                 case 'rtlsdr':
                     config.Source.SampleRate = parseInt($("#rtlsdrSampleRate").val(), 10);
                     break
                 case 'airspy':
                     config.Source.SampleRate = parseInt($("#airspySampleRate").val(), 10);
                     break
                 case 'spyserver':
                     config.Source.SampleRate = parseInt($("#spyserverSampleRate").val(), 10);
                     break
             }

             // Airspy Source
             config.AirspySource.MixerGain = parseInt($("#airspyMixerGain").val(), 10);
             config.AirspySource.LNAGain = parseInt($("#airspyLNAGain").val(), 10);
             config.AirspySource.VGAGain = parseInt($("#airspyVGAGain").val(), 10);
             config.AirspySource.BiasTEnabled = $("#airspyBiasT").is(':checked');

             // RTLSDR Source
             config.RtlsdrSource.MixerGain = parseInt($("#rtlsdrMixerGain").val(), 10);
             config.RtlsdrSource.LNAGain = parseInt($("#rtlsdrLNAGain").val(), 10);
             config.RtlsdrSource.VGAGain = parseInt($("#rtlsdrVGAGain").val(), 10);
             config.RtlsdrSource.BiasTEnabled = $("#rtlsdrBiasT").is(':checked');

             // Lime Source
             config.LimeSource.LNAGain = parseInt($("#limeGain").val(), 10);
             // config.LimeSource.Antenna = Set by selectLimeAntenna

             // CFile Source
             config.CFileSource.Filename = $("#filepath").val();
             config.CFileSource.FastAsPossible = $("#fastAsPossible").is(':checked');

             // Spyserver Source
             config.SpyserverSource.Gain = parseInt($("#spyserverGain").val(), 10);
             config.SpyserverSource.Hostname = $("#spyserverHostname").val();
             config.SpyserverSource.Port = parseInt($("#spyserverPort").val(), 10);
             $("#demuxerCollapse").collapse('show');
         }

         function selectLimeAntenna(antenna) {
             config.LimeSource.Antenna = antenna;
             refreshView();
         }

         function selectProtocol(protocol) {
             config.Base.Mode = protocol;
             refreshView();
             $("#sdrCollapse").collapse('show');
         }

         function selectSdr(sdr) {
             config.Base.DeviceType = sdr;
             refreshView();
             $("#sdrSettingsCollapse").collapse('show');
         }

         function refreshView(firstTime) {
             if (firstTime) {
               if(config.Base.Decimation !== 0) {
                  $("#decimation").val(config.Base.Decimation);
               }
               $("#agcEnabled").attr('checked', config.Base.AGCEnabled);
               // Base Source
               if(config.Source.Frequency !== 0) {
                  $("#frequency").val(config.Source.Frequency);
               }
               if (config.Source.SampleRate !== 0) {
                  switch (config.Base.DeviceType) {
                     case 'limedrv':
                     case 'lime':
                         $("#limeSampleRate").val(config.Source.SampleRate);
                         break
                     case 'cfile':
                         $("#cfileSampleRate").val(config.Source.SampleRate);
                         break
                     case 'rtlsdr':
                         $("#rtlsdrSampleRate").val(config.Source.SampleRate);
                         break
                     case 'airspy':
                         $("#airspySampleRate").val(config.Source.SampleRate);
                         break
                     case 'spyserver':
                         $("#spyserverSampleRate").val(config.Source.SampleRate);
                         break
                 }
               }

               // Airspy Source
               $("#airspyMixerGain").val(config.AirspySource.MixerGain);
               $("#airspyLNAGain").val(config.AirspySource.LNAGain);
               $("#airspyVGAGain").val(config.AirspySource.VGAGain);
               $("#airspyBiasT").attr('checked', config.AirspySource.BiasTEnabled);

               // RTLSDR Source
               $("#rtlsdrMixerGain").val(config.RtlsdrSource.MixerGain);
               $("#rtlsdrLNAGain").val(config.RtlsdrSource.LNAGain);
               $("#rtlsdrVGAGain").val(config.RtlsdrSource.VGAGain);
               $("#rtlsdrBiasT").attr('checked', config.RtlsdrSource.BiasTEnabled);

               // Lime Source
               $("#limeGain").val(config.LimeSource.LNAGain);

               // CFile Source
               $("#filepath").val(config.CFileSource.Filename);
               $("#fastAsPossible").attr('checked', config.CFileSource.FastAsPossible);

               // Spyserver Source
               $("#spyserverGain").val(config.SpyserverSource.Gain);
               $("#spyserverHostname").val(config.SpyserverSource.Hostname);
               $("#spyserverPort").val(config.SpyserverSource.Port);

               // Demuxer
               $("#temporaryFolder").val(config.DirectDemuxer.TemporaryFolder);
               if (config.DirectDemuxer.TemporaryFolder === '') {
                  config.DirectDemuxer.TemporaryFolder = 'tmp';
               }

               $("#outputFolder").val(config.DirectDemuxer.OutputFolder);
               if (config.DirectDemuxer.OutputFolder === '') {
                  config.DirectDemuxer.OutputFolder = 'out';
               }

               $("#purgeFilesAfterProcess").attr('checked', config.DirectDemuxer.PurgeFilesAfterProcess);
               $("#reprojectImages").attr('checked', config.DirectDemuxer.ReprojectImages);
               $("#drawMap").attr('checked', config.DirectDemuxer.DrawMap);
               $("#falseColor").attr('checked', config.DirectDemuxer.FalseColor);
               $("#enhanced").attr('checked', config.DirectDemuxer.Enhanced);
               $("#metaFrame").attr('checked', config.DirectDemuxer.MetaFrame);
             }

             if ($("#frequency").val() === '' && config.Base.Mode !== '') {
                 $("#frequency").val(config.Base.Mode === 'hrit' ? '1694100000' : '1691000000')
             }

             if (config.LimeSource.Antenna !== '') {
                 $("#limeAntenna").html(config.LimeSource.Antenna);
             }

             $("#protocolbtn").html('Satellite Protocol (<B>' + config.Base.Mode + '</B>)');
             $("div[id^=sdrConfig]").hide();
             $("#sdrConfirmBtn").removeAttr("disabled");
             $("#sdrConfirmBtn").html("OK");

             switch (config.Base.DeviceType) {
                 case 'limedrv':
                 case 'lime':
                     $("#sdrbtn").html('SDR (<B>LimeSDR</B>)');
                     $("#sdrConfigLime").show();
                     break
                 case 'cfile':
                     $("#sdrbtn").html('SDR (<B>GNURadio CFile</B>)');
                     $("#sdrConfigCFile").show();
                     break
                 case 'rtlsdr':
                     $("#sdrbtn").html('SDR (<B>RTLSDR</B>)');
                     $("#sdrConfigRTLSDR").show();
                     break
                 case 'airspy':
                     $("#sdrbtn").html('SDR (<B>Airspy</B>)');
                     $("#sdrConfigAirspy").show();
                     break
                 case 'spyserver':
                     $("#sdrbtn").html('SDR (<B>SpyServer</B>)');
                     $("#sdrConfigSpyserver").show();
                     break
                 default:
                     $("#sdrbtn").html('SDR')
                     $("#sdrConfirmBtn").html("Select SDR First");
                     $("#sdrConfirmBtn").prop("disabled", true);
             }
         }

         async function start() {
             console.log("Loading config");
             await SatHelperApp_LoadConfig();
             config = await SatHelperApp_GetConfig();
             console.log(config);
             refreshView(true);
             $("#configAccordion").show();
             $("input[id$=Gain]").keypress(function (evt) {  evt.preventDefault(); });
         }
         document.addEventListener('astilectron-ready', function() {
           start();
         })
      </script>
   </body>
</html>